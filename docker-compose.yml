services: # 아래에서 설정한 컨테이너들을 하나로 묶어줌
  mysql:
    image: mysql:8.0 # docker mysql 이미지 버전
    container_name: spoton-mysql # 컨테이너 이름
    environment: # mysql 환경변수
      MYSQL_ROOT_PASSWORD: 1234 # root 비밀번호
      MYSQL_DATABASE: spoton-backend # mysql database 이름
      TZ: Asia/Seoul # 시간을 서울 기준으로
    ports: # 포트 번호
      - "3307:3306"
    volumes: # 디비 저장소
      - db-data:/var/lib/mysql
    networks: # docker 컨테이너를 연결하고 호스트와 통신할 수 있도록 해줌
      - app-network
    restart: always # 종료되어도 자동으로 재실행

    backend:
    image: your-backend-image  # 애플리케이션 이미지 명시
    container_name: spoton-backend
    environment:
      SPRING_PROFILES_ACTIVE: test  # Spring Boot 프로파일 설정 (test 프로파일 사용)
    depends_on:
      - mysql  # mysql 서비스가 준비된 후에 backend가 실행되도록 보장
    ports:
      - "8080:8080"
    networks:
      - app-network
    restart: always

networks:
  app-network:
    driver: bridge
volumes:
  db-data:
